<!-- Contenedor principal oculto hasta que se haga login -->
<div class="container" ng-if="esAdmin">
    <div class="page-header">
        <h1>Panel de Mantenimiento</h1>
    </div>

    <ul class="nav nav-tabs">
        <li ng-class="{active: tabActivo === 'autos'}">
            <a href="" ng-click="seleccionarTab('autos')">Automóviles</a>
        </li>
        <li ng-class="{active: tabActivo === 'marcas'}">
            <a href="" ng-click="seleccionarTab('marcas')">Marcas</a>
        </li>
        <li ng-class="{active: tabActivo === 'modelos'}">
            <a href="" ng-click="seleccionarTab('modelos')">Modelos</a>
        </li>
    </ul>

    <div class="tab-content" style="padding-top: 20px;">

        <div id="tab-autos" class="tab-pane fade" ng-class="{'in active': tabActivo === 'autos'}">
            <h3>Gestión de Automóviles</h3>
            <button class="btn btn-primary" ng-click="prepararNuevoAuto()">
                <span class="glyphicon glyphicon-plus"></span> Nuevo Automóvil
            </button>
            <table class="table table-striped table-hover" style="margin-top: 15px;">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Marca</th>
                        <th>Modelo</th>
                        <th>Año</th>
                        <th>Precio</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="auto in automoviles">
                        <td>{{auto.id}}</td>
                        <td>{{auto.marca}}</td>
                        <td>{{auto.modelo}}</td>
                        <td>{{auto.anio}}</td>
                        <td>{{auto.precio | currency:'$'}} MXN</td>
                        <td>
                            <button class="btn btn-sm btn-warning" ng-click="prepararEditarAuto(auto)">Editar</button>
                            <button class="btn btn-sm btn-danger" ng-click="borrarAuto(auto.id)">Borrar</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="tab-marcas" class="tab-pane fade" ng-class="{'in active': tabActivo === 'marcas'}">
            <h3>Gestión de Marcas</h3>
            <button class="btn btn-primary" ng-click="prepararNuevaMarca()">
                <span class="glyphicon glyphicon-plus"></span> Nueva Marca
            </button>
            <table class="table table-striped table-hover" style="margin-top: 15px;">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="marca in marcas">
                        <td>{{marca.id}}</td>
                        <td>{{marca.nombre}}</td>
                        <td>
                            <button class="btn btn-sm btn-warning" ng-click="prepararEditarMarca(marca)">Editar</button>
                            <button class="btn btn-sm btn-danger" ng-click="borrarMarca(marca.id)">Borrar</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="tab-modelos" class="tab-pane fade" ng-class="{'in active': tabActivo === 'modelos'}">
            <h3>Gestión de Modelos</h3>
            <button class="btn btn-primary" ng-click="prepararNuevoModelo()">
                <span class="glyphicon glyphicon-plus"></span> Nuevo Modelo
            </button>
            <table class="table table-striped table-hover" style="margin-top: 15px;">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Marca</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="modelo in modelos">
                        <td>{{modelo.id}}</td>
                        <td>{{modelo.nombre}}</td>
                        <td>{{getMarcaNombre(modelo.marcaId)}}</td>
                        <td>
                            <button class="btn btn-sm btn-warning" ng-click="prepararEditarModelo(modelo)">Editar</button>
                            <button class="btn btn-sm btn-danger" ng-click="borrarModelo(modelo.id)">Borrar</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modales de Edición (Autos, Marcas, Modelos) -->
<div class="modal fade" id="autoModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">{{modoEdicionAuto ? 'Editar' : 'Nuevo'}} Automóvil</h4>
            </div>
            <div class="modal-body">
                <form name="autoForm">
                    <div class="form-group">
                        <label>Marca</label>
                        <select class="form-control" ng-model="autoSeleccionado.marcaId" ng-change="filtrarModelos()" ng-options="m.id as m.nombre for m in marcas">
                            <option value="">Seleccione una marca</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Modelo</label>
                        <select class="form-control" ng-model="autoSeleccionado.modeloId" ng-change="actualizarNombreModelo()" ng-disabled="!autoSeleccionado.marcaId"
                                ng-options="md.id as md.nombre for md in modelosFiltrados">
                            <option value="">Seleccione un modelo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Año</label>
                        <input type="number" class="form-control" ng-model="autoSeleccionado.anio">
                    </div>
                    <div class="form-group">
                        <label>Precio (MXN)</label>
                        <input type="number" class="form-control" ng-model="autoSeleccionado.precio">
                    </div>
                    <div class="form-group">
                        <label>Color (Nombre)</label>
                        <input type="text" class="form-control" ng-model="autoSeleccionado.color">
                    </div>
                    <div class="form-group">
                        <label>Color (Hex)</label>
                        <input type="text" class="form-control" ng-model="autoSeleccionado.colorHex">
                    </div>
                     <div class="form-group">
                        <label>URL de Imagen Principal</label>
                        <input type="text" class="form-control" ng-model="autoSeleccionado.imagenUrl" placeholder="Ej: img/nuevo_auto.jpg">
                    </div>
                     <div class="form-group">
                        <label>ID Sketchfab</label>
                        <input type="text" class="form-control" ng-model="autoSeleccionado.sketchfabModelId">
                    </div>

                    <div class="form-group">
                        <label>Galería de Imágenes</label>
                        <div class="input-group">
                            <input type="text" class="form-control" ng-model="nuevaImagenUrl" placeholder="URL de imagen extra (ej: img/foto2.jpg)">
                            <span class="input-group-btn">
                                <button class="btn btn-success" type="button" ng-click="agregarImagenGaleria()">
                                    <span class="glyphicon glyphicon-plus"></span>
                                </button>
                            </span>
                        </div>
                        <div class="row" style="margin-top: 10px;">
                            <div class="col-xs-3" ng-repeat="img in autoSeleccionado.galeriaImagenes track by $index" style="position: relative; margin-bottom: 10px;">
                                <img ng-src="{{img}}" class="img-thumbnail" style="width: 100%; height: 60px; object-fit: cover;">
                                <button class="btn btn-xs btn-danger" style="position: absolute; top: 0; right: 15px;" ng-click="eliminarImagenGaleria($index)">&times;</button>
                            </div>
                        </div>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" ng-click="guardarAuto()" ng-disabled="autoForm.$invalid">Guardar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="marcaModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">{{modoEdicionMarca ? 'Editar' : 'Nueva'}} Marca</h4>
            </div>
            <div class="modal-body">
                <form name="marcaForm">
                    <div class="form-group">
                        <label>Nombre de la Marca</label>
                        <input type="text" class="form-control" ng-model="marcaSeleccionada.nombre" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" ng-click="guardarMarca()" ng-disabled="marcaForm.$invalid">Guardar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modeloModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">{{modoEdicionModelo ? 'Editar' : 'Nuevo'}} Modelo</h4>
            </div>
            <div class="modal-body">
                <form name="modeloForm">
                    <div class="form-group">
                        <label>Marca</label>
                        <select class="form-control" ng-model="modeloSeleccionado.marcaId" ng-options="m.id as m.nombre for m in marcas" required>
                            <option value="">Seleccione una marca</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Nombre del Modelo</label>
                        <input type="text" class="form-control" ng-model="modeloSeleccionado.nombre" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" ng-click="guardarModelo()" ng-disabled="modeloForm.$invalid">Guardar</button>
            </div>
        </div>
    </div>
</div>

<!-- LOGIN -->
<div class="modal fade" id="loginModal" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title text-center">Acceso Restringido</h4>
            </div>
            <div class="modal-body">
                <p>Ingrese la contraseña de administrador para continuar.</p>
                <form ng-submit="verificarLogin()">
                    <div class="form-group">
                        <input type="password" class="form-control" placeholder="Contraseña" ng-model="loginData.password" autofocus>
                    </div>
                    <div class="alert alert-danger" ng-if="loginError">
                        Contraseña incorrecta.
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Ingresar</button>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-block" ng-click="cancelarLogin()">Cancelar y Volver</button>
            </div>
        </div>
    </div>
</div>